import React, {useEffect, useState } from 'react';
import { useNavigate } from 'react-router-dom';
import "../styles/components/Movie-detail-layout.css";
import { getMovieByTitle } from '../services/movie.service';
import { getUser } from '../services/usuario.service';
import { addFavorito, deleteFavorito, getFavorito } from '../services/favorito.service';
import { addRecomendacion } from '../services/recomendacion.service';

function MovieDetailLayout({ title }) {
    const camera = <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 256 256"><path fill="#a9cc30" d="M216 106H86.68l122.85-32.43a6 6 0 0 0 4.26-7.38l-8.16-30a13.94 13.94 0 0 0-17-9.72L36.32 66.67a13.77 13.77 0 0 0-8.48 6.47a13.57 13.57 0 0 0-1.36 10.42L34 111.34V200a14 14 0 0 0 14 14h160a14 14 0 0 0 14-14v-88a6 6 0 0 0-6-6m-90.25-50.52l33 19.07l-42.43 11.2l-33-19.07Zm66-17.41a1.92 1.92 0 0 1 2.34 1.26l6.57 24.18l-25.4 6.69l-33-19.07ZM38.23 79.14a1.85 1.85 0 0 1 1.15-.87L66.86 71l33 19.08l-55.2 14.6l-6.6-24.27a1.63 1.63 0 0 1 .17-1.27M210 200a2 2 0 0 1-2 2H48a2 2 0 0 1-2-2v-82h164Z"></path></svg>
    const clock = <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="#a9cc30" strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5}><path d="M21 12a9 9 0 1 1-18 0a9 9 0 0 1 18 0"></path><path d="M12 6v6l4 2"></path></g></svg>
    const score = <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><path fill="none" stroke="#a9cc30" stroke-width="1.5" d="M9.153 5.408C10.42 3.136 11.053 2 12 2s1.58 1.136 2.847 3.408l.328.588c.36.646.54.969.82 1.182s.63.292 1.33.45l.636.144c2.46.557 3.689.835 3.982 1.776c.292.94-.546 1.921-2.223 3.882l-.434.507c-.476.557-.715.836-.822 1.18c-.107.345-.071.717.001 1.46l.066.677c.253 2.617.38 3.925-.386 4.506s-1.918.051-4.22-1.009l-.597-.274c-.654-.302-.981-.452-1.328-.452s-.674.15-1.328.452l-.596.274c-2.303 1.06-3.455 1.59-4.22 1.01c-.767-.582-.64-1.89-.387-4.507l.066-.676c.072-.744.108-1.116 0-1.46c-.106-.345-.345-.624-.821-1.18l-.434-.508c-1.677-1.96-2.515-2.941-2.223-3.882S3.58 8.328 6.04 7.772l.636-.144c.699-.158 1.048-.237 1.329-.45s.46-.536.82-1.182z"/></svg>
    const genre = <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><path fill="#a9cc30" d="M2.616 20.5v-17h18.769v17zm1-1h3v-3h-3zm13.769 0h3v-3h-3zM11.5 15.923h1v-5.115h-1zM3.616 15.5h3v-3h-3zm13.769 0h3v-3h-3zm-13.77-4h3v-3h-3zm13.77 0h3v-3h-3zM12 9q.262 0 .439-.177q.176-.177.176-.438q0-.262-.177-.439T12 7.77t-.438.177t-.177.439t.177.438T12 9M3.615 7.5h3v-3h-3zm13.77 0h3v-3h-3zm-9.77 12h8.77v-15h-8.77zm0-15h8.77z"/></svg>
    const actors = <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 16 16"><g fill="none" stroke="#a9cc30" stroke-linecap="round" stroke-linejoin="round" stroke-width="0.8"><circle cx="5" cy="9" r="2.25"/><circle cx="11" cy="4" r="2.25"/><path d="M7.75 9.25c0-1 .75-3 3.25-3s3.25 2 3.25 3m-12.5 5c0-1 .75-3 3.25-3s3.25 2 3.25 3"/></g></svg>
    const available = <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 20 20"><path fill="#a9cc30" d="M9.995 0C4.475 0 0 4.475 0 9.995s4.475 9.996 9.995 9.996s9.996-4.475 9.996-9.996C19.99 4.475 15.516 0 9.995 0M2 9.995a7.995 7.995 0 1 1 15.99 0a7.995 7.995 0 0 1-15.99 0m12.207-3.202a1 1 0 0 1 0 1.414l-4.5 4.5a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.793-3.793a1 1 0 0 1 1.414 0"/></svg>
    const star= <svg xmlns="http://www.w3.org/2000/svg" width="3.2em" height="3.2m" viewBox="0 0 24 24"><path fill="#f1fe00" d="m8.85 16.825l3.15-1.9l3.15 1.925l-.825-3.6l2.775-2.4l-3.65-.325l-1.45-3.4l-1.45 3.375l-3.65.325l2.775 2.425zm3.15-.723l-3.63 2.192q-.16.079-.297.064q-.136-.016-.265-.094q-.13-.08-.196-.226t-.012-.319l.966-4.11l-3.195-2.77q-.135-.11-.178-.263t.019-.293t.165-.23q.104-.087.28-.118l4.216-.368l1.644-3.892q.068-.165.196-.238T12 5.364t.288.073t.195.238l1.644 3.892l4.215.368q.177.03.281.119q.104.088.166.229q.061.14.018.293t-.178.263l-3.195 2.77l.966 4.11q.056.171-.011.318t-.197.226q-.128.08-.265.095q-.136.015-.296-.064zm0-3.852"></path></svg>
    const favorite= <svg xmlns="http://www.w3.org/2000/svg" width="3.2em" height="3.2m" viewBox="0 0 24 24"><path fill="#f1fe00" d="m12 16.102l-3.63 2.192q-.16.079-.297.064q-.136-.016-.265-.094q-.13-.08-.196-.226t-.012-.319l.966-4.11l-3.195-2.77q-.135-.11-.178-.263t.019-.293t.165-.23q.104-.087.28-.118l4.216-.368l1.644-3.892q.068-.165.196-.238T12 5.364t.288.073t.195.238l1.644 3.892l4.215.368q.177.03.281.119q.104.088.166.229q.061.14.018.293t-.178.263l-3.195 2.77l.966 4.11q.056.171-.011.318t-.197.226q-.128.08-.265.095q-.136.015-.296-.064z"></path></svg>
    
    const recomendaciones= <svg xmlns="http://www.w3.org/2000/svg" width="2.2em" height="2.2em" viewBox="0 0 16 16"><path fill="#fff" fillRule="evenodd" d="M7.29 13.904L5.25 10.75L2.096 8.71a2.4 2.4 0 0 1 .5-4.278l9.273-3.296a2.346 2.346 0 0 1 2.996 2.995L13.45 3.63a.844.844 0 0 0-1.08-1.08L3.1 5.846a.9.9 0 0 0-.19 1.604l2.78 1.799l3.279-3.28a.75.75 0 1 1 1.06 1.061L6.75 10.31l1.799 2.779a.9.9 0 0 0 1.604-.188l3.297-9.272l1.413.502l-3.296 9.273a2.4 2.4 0 0 1-4.277.5" clipRule="evenodd"></path></svg>
    const criticas= <svg xmlns="http://www.w3.org/2000/svg" width="2.2em" height="2.2em" viewBox="0 0 24 24"><g fill="none" stroke="#fff" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}><rect width={8} height={4} x={8} y={2} rx={1}></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-5.5M4 13.5V6a2 2 0 0 1 2-2h2"></path><path d="M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"></path></g></svg>   

    const icons= {
        "Netflix": <svg xmlns="http://www.w3.org/2000/svg" width="4em" height="3em" viewBox="0 0 256 256"><defs><path id="logosNetflixIcon0" fill="#b1060f" stroke="#000" d="m141.676 41.275l-.067 38.361l-.068 38.361l-3.156-8.905l-.006-.017l-4.078 85.402c4.01 11.324 6.158 17.369 6.182 17.393c.031.032 2.317.17 5.078.307c8.366.415 18.734 1.304 26.599 2.282c1.821.226 3.388.342 3.483.257c.094-.084.145-39.143.114-86.797l-.058-86.644zm-61.538-.115v86.732c0 47.703.047 86.779.104 86.836s3.011-.222 6.565-.62c3.553-.398 8.465-.893 10.914-1.1c3.756-.317 14.97-1.038 16.268-1.046c.378-.002.402-1.95.457-36.735l.058-36.734l2.713 7.677l.96 2.713l4.077-85.381l-1.401-3.96a32066 32066 0 0 0-6.283-17.754l-.225-.628z" strokeWidth={1}></path><path id="logosNetflixIcon1" fill="url(#logosNetflixIcon3)" d="M80.138 41.16v48.685l34.296 90.976c.004-2.085.008-3.211.012-5.594l.058-36.734l2.713 7.677c15.104 42.738 23.218 65.652 23.266 65.7c.031.032 2.317.17 5.078.307c8.366.415 18.734 1.304 26.599 2.282c1.821.226 3.388.342 3.483.257c.064-.058.107-19.21.118-46.227l-34.136-98.14l-.016 9.287l-.068 38.361l-3.156-8.905c-3.084-8.701-5.143-14.52-17.532-49.55a32066 32066 0 0 0-6.283-17.754l-.225-.628z"></path><path id="logosNetflixIcon2" fill="#e50914" d="m80.139 41.16l34.365 97.377v-.044l2.713 7.677c15.104 42.738 23.218 65.652 23.266 65.7c.031.032 2.317.17 5.078.307c8.366.415 18.734 1.304 26.599 2.282c1.812.225 3.37.34 3.48.258l-34.1-96.737v.017l-3.156-8.905c-3.084-8.701-5.143-14.52-17.532-49.55c-3.332-9.42-6.159-17.408-6.283-17.754l-.225-.628z"></path><radialGradient id="logosNetflixIcon3" cx="48.34%" cy="49.419%" r="70.438%" fx="48.34%" fy="49.419%" gradientTransform="matrix(1 0 0 .55088 0 .222)"><stop offset="0%"></stop><stop offset="100%" stopOpacity={0}></stop></radialGradient></defs><path d="M0 0h255.904v255.904H0z"></path><use href="#logosNetflixIcon0" strokeWidth={2.956}></use><use href="#logosNetflixIcon1"></use><use href="#logosNetflixIcon2"></use><use href="#logosNetflixIcon0" strokeWidth={2.956}></use><use href="#logosNetflixIcon1"></use><use href="#logosNetflixIcon2"></use></svg>,
        "Prime Video": <svg xmlns="http://www.w3.org/2000/svg" width="4em" height="3.6em" viewBox="0 0 24 24"><path fill="#00bcfe" d="M5.76 2A3.76 3.76 0 0 0 2 5.76v12.48A3.76 3.76 0 0 0 5.76 22h12.48A3.76 3.76 0 0 0 22 18.24V5.76A3.76 3.76 0 0 0 18.24 2zm5.135 3.05v.003h.043a.4.4 0 0 1 .167.023a.41.41 0 0 1 .282.46a.396.396 0 0 1-.344.36a.7.7 0 0 1-.242 0a.4.4 0 0 1-.344-.445a.42.42 0 0 1 .438-.4zm-4.24 1.212a1.05 1.05 0 0 1 1.01.654q.114.26.138.543h-.006c.035.302.008.609-.08.9a1.33 1.33 0 0 1-.375.602a1.06 1.06 0 0 1-.85.264a1.2 1.2 0 0 1-.629-.248c-.026.022-.013.048-.013.076v1.027c0 .224 0 .225-.229.225h-.39a.2.2 0 0 1-.2-.088l.004-3.795a.26.26 0 0 1 .217-.072h.334a.14.14 0 0 1 .158.12a1 1 0 0 0 .026.112q.003.01.013.01a.3.3 0 0 0 .076-.055c.229-.18.51-.276.795-.275zm7.087.004q.137 0 .272.027a.68.68 0 0 1 .437.309v.01c.091-.055.187-.113.285-.163c.253-.13.536-.194.82-.181c.4-.013.733.301.745.7v2.02c0 .162-.021.186-.184.186h-.527a.1.1 0 0 1-.086-.084a1 1 0 0 1-.008-.12V7.298a.7.7 0 0 0-.021-.201a.27.27 0 0 0-.246-.201a1.3 1.3 0 0 0-.622.12a.06.06 0 0 0-.044.065v1.902q.002.054-.006.106c0 .047-.04.086-.088.086h-.553c-.134 0-.162-.032-.162-.166V7.297a1 1 0 0 0-.018-.188a.275.275 0 0 0-.254-.218a1.3 1.3 0 0 0-.63.125a.06.06 0 0 0-.041.068v1.934c0 .132-.031.16-.165.16h-.478c-.128 0-.162-.039-.162-.16l-.004-2.508q0-.045.012-.088a.1.1 0 0 1 .097-.07h.46c.06 0 .11.043.124.101c.02.05.03.1.047.152c.037 0 .059-.024.084-.039c.196-.13.415-.222.645-.271q.135-.028.271-.027zm4.4.023a1.6 1.6 0 0 1 .54.082a.863.863 0 0 1 .539 1.086a.67.67 0 0 1-.332.398q-.211.113-.45.147c-.273.044-.55.04-.822-.012a1 1 0 0 0-.101-.017a.605.605 0 0 0 .49.654c.224.044.454.044.678 0c.105-.022.205-.046.31-.07c.105-.026.149.008.149.115v.267a.166.166 0 0 1-.123.178a2 2 0 0 1-.426.115c-.274.05-.556.047-.828-.007a1.135 1.135 0 0 1-.928-.868a2 2 0 0 1 .012-1.127h-.002c.13-.517.58-.893 1.113-.93q.09-.01.182-.01zm-8.105.033c.094 0 .125.03.133.121c.007.124 0 .251 0 .373a.7.7 0 0 1-.008.15a.1.1 0 0 1-.1.098q-.075.005-.15 0a1.7 1.7 0 0 0-.701.102c-.05.018-.049.053-.049.094v1.826a.09.09 0 0 1-.088.084a1 1 0 0 1-.09 0v.006h-.55a.1.1 0 0 1-.084-.09V6.533c0-.166.015-.183.181-.183h.348a.144.144 0 0 1 .164.12q.038.134.068.28a.1.1 0 0 0 .06-.045q.099-.097.208-.184a.96.96 0 0 1 .658-.199m.604.028q.282-.006.564 0c.083 0 .107.024.115.107v2.502q.002.06-.006.121a.09.09 0 0 1-.085.082a.3.3 0 0 1-.063 0l.004.006h-.502a.2.2 0 0 1-.05 0a.097.097 0 0 1-.098-.094V6.473c0-.087.035-.118.12-.121V6.35zm7.435.496a.54.54 0 0 0-.476.341a1 1 0 0 0-.069.252c-.004.06-.005.061.05.065q.21.032.425.031a.8.8 0 0 0 .232-.02a.32.32 0 0 0 .276-.208a.4.4 0 0 0 .011-.188a.28.28 0 0 0-.166-.228a.6.6 0 0 0-.193-.043a1 1 0 0 0-.09-.002m-11.683.033a1 1 0 0 0-.463.11a.11.11 0 0 0-.07.113v1.306a.1.1 0 0 0 .06.1a1 1 0 0 0 .525.115v.002a.5.5 0 0 0 .332-.129a.55.55 0 0 0 .166-.289c.059-.223.074-.457.045-.686a1 1 0 0 0-.092-.367a.45.45 0 0 0-.343-.26a1 1 0 0 0-.16-.015m2.39 3.463a.3.3 0 0 1 .074 0a.44.44 0 0 1 .215.037a.38.38 0 0 1 .244.338a.42.42 0 0 1-.351.486V11.2a.4.4 0 0 1-.133 0a1 1 0 0 1-.12-.013a.41.41 0 0 1-.316-.479a.4.4 0 0 1 .387-.365zm3.1.03h.502c.11.003.14.027.14.14v3.808c0 .1-.032.137-.132.137h-.473a.13.13 0 0 1-.127-.1a.6.6 0 0 0-.037-.125c-.033.007-.048.03-.074.045a1.17 1.17 0 0 1-1.102.188a1.04 1.04 0 0 1-.623-.553a1.7 1.7 0 0 1-.182-.771a2.05 2.05 0 0 1 .125-.834c.098-.28.3-.512.565-.645c.376-.179.816-.15 1.166.076q.036.029.082.04v-.007c.018-.025.008-.052.008-.078v-1.162c0-.137.024-.16.162-.16zm5.527 1.177a1.32 1.32 0 0 1 1.305 1.164v.008h-.01v.066a.06.06 0 0 0 .018.057v-.016l.004.008v.416l-.008.014v-.008c-.022.014-.016.034-.016.056v.051a1.24 1.24 0 0 1-1.121 1.17a1.8 1.8 0 0 1-.68-.037a1.15 1.15 0 0 1-.85-.758a1.93 1.93 0 0 1 0-1.369c.15-.442.547-.756 1.012-.8q.172-.029.346-.022m-3.004.03q.275-.013.54.067c.3.084.526.329.591.633c.027.133.027.27 0 .403a.67.67 0 0 1-.365.48c-.19.095-.398.147-.61.154a2.8 2.8 0 0 1-.712-.045h-.004a.1.1 0 0 0-.047-.005q.01.111.039.22a.57.57 0 0 0 .478.434c.247.042.5.033.743-.027c.079-.018.153-.035.232-.057c.105-.025.152.017.152.117v.262a.16.16 0 0 1-.129.183a2.3 2.3 0 0 1-.779.149a2 2 0 0 1-.54-.055a1.11 1.11 0 0 1-.829-.773a2 2 0 0 1-.016-1.21a1.264 1.264 0 0 1 1.256-.93m-5.8.058h.511c.112.004.145.038.145.15l.002-.006v2.569a.1.1 0 0 1-.09.107h-.602a.1.1 0 0 1-.11-.088v-.017a.4.4 0 0 1 0-.069v-2.502c0-.112.032-.144.143-.144zm-3.245.004h.616c.086 0 .126.057.148.132c.04.138.082.28.125.416c.148.501.293 1.01.44 1.512h.007l.065-.21l.5-1.677l.02-.064a.15.15 0 0 1 .146-.102h.552c.138-.002.167.037.122.166l-.004-.002l-.22.575l-.726 1.892l-.023.065a.18.18 0 0 1-.182.12H6.47a.2.2 0 0 1-.217-.15c-.09-.237-.185-.48-.275-.718q-.328-.851-.655-1.71a.6.6 0 0 1-.047-.138c-.011-.073.014-.107.086-.107zm9.047.488a.54.54 0 0 0-.453.213a.9.9 0 0 0-.143.394c-.01.033.007.049.04.051q.216.034.435.037a.8.8 0 0 0 .225-.017a.32.32 0 0 0 .29-.225a.324.324 0 0 0-.269-.437c-.018 0-.03-.006-.049-.006zm-3.162.031a1 1 0 0 0-.142.002a.47.47 0 0 0-.381.244a.8.8 0 0 0-.07.178a1.8 1.8 0 0 0-.046.682c.01.126.044.25.1.363c.077.148.22.249.387.267a.9.9 0 0 0 .568-.107a.1.1 0 0 0 .059-.101v-.657h.006c0-.22-.008-.44 0-.662a.1.1 0 0 0-.067-.105a1.1 1.1 0 0 0-.414-.104m6.121.026a1 1 0 0 0-.103.003a.47.47 0 0 0-.37.225a.8.8 0 0 0-.101.236a2 2 0 0 0-.03.64q.019.188.102.358c.061.141.19.242.34.27a.7.7 0 0 0 .207.008a.47.47 0 0 0 .342-.201a.7.7 0 0 0 .101-.21l-.005.01q.066-.226.05-.463a2 2 0 0 0 0-.199a1.1 1.1 0 0 0-.101-.41a.47.47 0 0 0-.33-.256a1 1 0 0 0-.102-.011m1.082 3.226q.354.002.7.082q.096.026.187.07a.24.24 0 0 1 .15.202q.021.153.01.308a4 4 0 0 1-.549 1.738l-.004.004a2.4 2.4 0 0 1-.418.52a.3.3 0 0 1-.117.07a.084.084 0 0 1-.115-.084a.4.4 0 0 1 .025-.11a13 13 0 0 0 .348-1.026q.085-.289.123-.586a1 1 0 0 0 0-.217a.28.28 0 0 0-.2-.264a1.4 1.4 0 0 0-.347-.064a5.7 5.7 0 0 0-.996.043l-.437.054c-.048 0-.09 0-.116-.043a.13.13 0 0 1 .01-.13a.4.4 0 0 1 .111-.1c.268-.184.568-.316.885-.385q.372-.074.75-.082m-13.82.178a.1.1 0 0 1 .049.01a1 1 0 0 1 .093.046a14 14 0 0 0 4.204 1.737a14 14 0 0 0 3.7.371a14.3 14.3 0 0 0 3.86-.71q.685-.228 1.344-.53a.3.3 0 0 1 .217-.03a.226.226 0 0 1 .162.272l-.014.047v.002a.4.4 0 0 1-.119.136a8 8 0 0 1-1.34.85a10.6 10.6 0 0 1-2.83.959q-.85.15-1.713.184v.015h-.441v-.012q-.298-.014-.592-.033a10.5 10.5 0 0 1-1.566-.238a10.6 10.6 0 0 1-4.694-2.45a15 15 0 0 1-.37-.341a.3.3 0 0 1-.067-.1a.134.134 0 0 1 .066-.175a.1.1 0 0 1 .05-.01z"></path></svg>,
        "Apple TV": <svg xmlns="http://www.w3.org/2000/svg" width="4.2em" height="3.8em" viewBox="0 0 48 48"><path fill="none" stroke="#fff" strokeLinecap="round" strokeLinejoin="round" d="M20.033 12.197q0 1.846-1.344 3.44c-1.081 1.264-2.388 1.994-3.806 1.88a4 4 0 0 1-.028-.467c0-1.18.514-2.444 1.426-3.477q.684-.784 1.738-1.305q1.053-.513 1.988-.563q.027.248.026.492s0 0 0 0M43.5 23.067l-4.214 11.167l-4.214-11.167M29.92 19.59v12.537c0 1.163.943 2.107 2.106 2.107h.632m-4.951-11.167h4.425" strokeWidth={1}></path><path fill="none" stroke="#fff" strokeLinecap="round" strokeLinejoin="round" d="M24.778 30.868q-.558 1.288-1.322 2.377q-1.044 1.487-1.703 2.058q-1.019.937-2.189.964q-.841 0-2.021-.483q-1.184-.482-2.177-.481q-1.042 0-2.238.481q-1.197.484-1.934.509q-1.122.048-2.238-.99q-.713-.622-1.781-2.13Q6.029 31.56 5.29 29.43q-.79-2.301-.79-4.46q0-2.471 1.068-4.26a6.3 6.3 0 0 1 2.24-2.265a6 6 0 0 1 3.028-.854q.89.002 2.341.545q1.45.544 1.858.546q.306 0 2.06-.643q1.655-.596 2.8-.497c2.068.167 3.623.982 4.656 2.451q-2.775 1.683-2.747 4.706q.026 2.355 1.704 3.91a5.6 5.6 0 0 0 1.703 1.118q-.203.594-.434 1.14z" strokeWidth={1.7}></path></svg>,
        "Disney+": <svg xmlns="http://www.w3.org/2000/svg" width="4em" height="3em" viewBox="0 0 24 24"><path fill="#fff" d="M2.056 6.834C1.572 6.834 1 6.77 1 6.483c0-2.023 3.562-2.11 5.08-2.11c1.978 0 4.506.614 6.66 1.384c3.277 1.188 9.917 5.145 9.917 9.674c0 4.001-4.31 5.914-8.311 5.914a22 22 0 0 1-3.21-.33c-.066.243-.11.418-.264.924a4.3 4.3 0 0 1-.77.087l-.505-.043c-.33-.396-.44-1.033-.572-1.715c-2-1.165-3.298-2.155-3.891-2.836c-.506-.528-1.078-1.232-1.078-1.913c0-.351.22-.66.726-1.01c1.034-.77 2.352-1.188 4.507-1.563l.044-.9c.022-.22.242-2.573.748-3.013c.813.66.901 1.341.967 2.353c.022.44.044.901.11 1.385h.308c1.539 0 6.244.395 6.244 2.616c0 .528-.77 1.517-1.518 1.517a1.9 1.9 0 0 1-.966-.285c.329-.375.813-.704.945-.99c-.44-.528-2.814-1.143-4.551-1.143a4 4 0 0 0-.572.022l.022 4.815c.703.44 1.561.483 2.11.483c2.42 0 7.431-.417 7.431-4.331c0-3.87-4.946-6.86-8.64-8.266a21.4 21.4 0 0 0-7.937-1.496a7.2 7.2 0 0 0-1.803.198c-.373.088-.505.176-.505.264c0 .153.747.242.836.286a.22.22 0 0 1 .11.175a.26.26 0 0 1-.088.176c-.089 0-.286.022-.528.022M9.2 14.551c-2.176.177-4.595.397-4.595 1.166c0 .594 1.012 1.32 1.627 1.781a7.05 7.05 0 0 0 2.77 1.319zm11.155-9.85c-.02.428-.042.942-.042 1.723c0 .3 0 .642.01 1.027c-.042.193-.32.214-.46.278a1.2 1.2 0 0 1-.256-.192V4.83c0-.29.01-.588.01-1.038c0-.225 0-.482-.01-.792c0-.192.032-.374.15-.802a.34.34 0 0 1 .3-.224c.245.064.491.17.577.374c-.257.76-.235 1.594-.279 2.353m-.384-.085c.428.021.941.042 1.722.042c.3 0 .643 0 1.027-.01c.193.041.215.32.279.459q-.078.141-.193.257H20.1c-.289 0-.589-.01-1.037-.01c-.225 0-.482 0-.792.01c-.193.002-.375-.03-.803-.149a.35.35 0 0 1-.225-.299c.064-.246.172-.492.374-.578c.76.257 1.595.235 2.355.278z" strokeWidth={0.7} stroke="#fff"></path></svg>,
        "Max": <svg xmlns="http://www.w3.org/2000/svg" width="4em" height="3.5em" viewBox="0 0 24 24"><path fill="#fff" d="M7.042 16.896H4.414v-3.754H2.708v3.754H.01L0 7.22h2.708v3.6h1.706v-3.6h2.628zm12.043.046C21.795 16.94 24 14.689 24 11.978a4.89 4.89 0 0 0-4.915-4.92c-2.707-.002-4.09 1.991-4.432 2.795c.003-1.207-1.187-2.632-2.58-2.634H7.59v9.674l4.181.001c1.686 0 2.886-1.46 2.888-2.713c.385.788 1.72 2.762 4.427 2.76zm-7.665-3.936c.387 0 .692.382.692.817s-.305.817-.692.817h-1.33v-1.634zm.005-3.633c.387 0 .692.382.692.817c0 .436-.305.818-.692.818h-1.33V9.373zm1.77 2.607c.305-.039.813-.387.992-.61c-.063.276-.068 1.074.006 1.35c-.204-.314-.688-.701-.998-.74m3.43 0a2.462 2.462 0 1 1 4.924 0a2.462 2.462 0 0 1-4.925 0zm2.462 1.936a1.936 1.936 0 1 0 0-3.872a1.936 1.936 0 0 0 0 3.872"></path></svg>
    }
    
    const [movie, setMovie] = useState([]);
    const [loading, setLoading] = useState(true);
    const [selected, setSelected] = useState(false);
    const[user, setUser]= useState(null);
    const [mensaje, setMensaje]= useState(null);
    const navigate = useNavigate();

const handleClick = async () => {
  if (!user || !movie.imdbId) return;

  if (!selected) {
    await addFavorito(movie.imdbId, user);
    setSelected(true);
  } else {
    await deleteFavorito(movie.imdbId, user);
    setSelected(false);
  }
};

const handleRecomendacion = async () => {
  if (!user || !movie.imdbId) return;
  const msg= await addRecomendacion(movie.imdbId, user);
  setMensaje(msg);
};

const handleCritica = async () => {
    navigate(`/critica/${movie.imdbId}/${user.nickname}`)
}
    useEffect(() => {
  if (!title) return;

  const fetchMovie = async () => {
    try {
      const storedMovies = localStorage.getItem('searchedMovies');
      let cached = storedMovies ? JSON.parse(storedMovies) : [];

      // Buscar por título (ignorando mayúsculas)
      const cachedMovie = cached.find(
        (item) =>
          item.title?.toLowerCase() === title.toLowerCase() &&
          item.showType === 'movie'
      );

      if (cachedMovie) {
        console.log('Cargando desde localStorage...');
        setMovie(cachedMovie);
      } else {
        console.log('Cargando desde la API...');
        const response = await getMovieByTitle(title);
        console.log('Respuesta de la API:', response);

        const foundMovie = response.find(
          (item) =>
            item.showType === 'movie' &&
            item.title?.toLowerCase() === title.toLowerCase()
        );

        if (foundMovie) {
          setMovie(foundMovie);

          // Guardar en localStorage
          const updated = [...cached, foundMovie];
          localStorage.setItem('searchedMovies', JSON.stringify(updated));
        } else {
          console.warn('Película no encontrada en los resultados.');
        }
      }
    } catch (error) {
      console.error('Error fetching movie:', error);
    } finally {
      setLoading(false);
    }
  };

  fetchMovie();
}, [title]);


   useEffect(() => {
    const fetchUser = async () => {
        const usuario = await getUser();
        setUser(usuario);
    };

    fetchUser();
    }, []);

useEffect(() => {
  const checkIfFavorite = async () => {
    if (user && movie?.imdbId) {
      try {
        const fav = await getFavorito(user.id, movie.imdbId);
        setSelected(!!fav);
      } catch (e) {
        console.warn("No es favorito o error inesperado:", e.message);
        setSelected(false);
      }
    }
  };

  if (user && movie?.imdbId) {
    checkIfFavorite();
  }
}, [user, movie?.imdbId]);

useEffect(() => {
  if (mensaje) {
    const timer = setTimeout(() => {
      setMensaje(null);
    }, 3000);

    return () => clearTimeout(timer);
  }
}, [mensaje]);

    if (loading) {
        return (
            <div className="loading-container">
                <div className="spinner" />
            </div>
        );
    }

    return (
        <div className="pelicula">
             {mensaje && (
            <div className="mensaje-flotante">{mensaje}</div>
          )}
            <div onClick={handleClick}>
                {selected ? favorite : star}
            </div>
            <div className='tituloPeli'>
                <h2>{movie ? movie.title : "Cargando..."}</h2>
                <img className="imagenPoster" src={movie.imageSet?.verticalPoster?.w720} alt={movie.title} />
            </div>
            <div className='link-icons'>
                <span className='link-icono' data='Haz una recomendación' onClick={handleRecomendacion}>{recomendaciones}</span>
                <span className='link-icono' data='Escribe una crítica' onClick={handleCritica}>{criticas}</span>
            </div>
            <div className='infoPeli'>
                <p className='overview'><strong>{movie.overview}</strong></p>
                <p><span>{camera}</span><strong><span>Director:</span></strong> {movie.directors} </p>
                <p><span>{clock}</span><strong><span>Duración:</span> </strong>{movie.runtime} </p>
                <p><span>{score}</span><strong><span>Puntuación: </span></strong>{movie.rating} </p>
                <p><span>{genre}</span><strong><span>Género: </span></strong>{movie.genres?.map((g) => g.name).join(', ')}</p>
                <p><span>{actors}</span><strong><span>Reparto: </span></strong> {movie.cast}</p>
                <p><span>{available}</span><strong><span>Disponible en: </span></strong>{" "}
                    {movie.streamingOptions?.es
                ? [...new Set(movie.streamingOptions.es.map((s) => s.service.name))].map((name, index) => (
                    <span key={index} style={{ marginRight: "10px" }}>
                    {icons[name] || name}
                    </span>
                )): "No disponible"}
            </p>
            </div>
        </div>
        
    );
}

export default MovieDetailLayout;
